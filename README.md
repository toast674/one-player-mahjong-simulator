# one-player-mahjong-simulator

一人麻雀における和了確率, 聴牌確率, 得点期待値などを計算する。

## 特徴
- 1巡目(第1自摸直後)から*n*巡以内に和了する確率や聴牌確率, 得点期待値などを求めることができます。
- JSONを使って打ち筋を自由に表現することができます。例えば速度重視, 得点重視の打ち筋や任意のパターンの手替わりを考慮した計算を実行することが可能です。
- 最終形と途中形にラベルをつけることができます。この機能によって和了確率, 聴牌確率だけでなく*n*シャンテン下がる確率, 良形聴牌確率を求めることができます。

## 使用方法
0. ライブラリをインストールします。
```
$ pip3 install -r requirements.txt
```
1. 手牌と打ち筋をJSONで定義します。
2. calc.pyを実行します。
```
$ python3 calc.py [JSONファイル]
```
実行例:
```
$ python3 calc.py sample/sample1.json
Enter the remaining turns.
17

Hai: 34789m456p222s112z
Probability:
Turn    Agari
1       0.0656
2       0.127
3       0.186
4       0.24
5       0.292
6       0.34
7       0.386
8       0.428
9       0.469
10      0.506
11      0.541
12      0.575
13      0.605
14      0.634
15      0.661
16      0.687
17      0.71
```

## サンプルファイル
- [sample1.json](sample1.json) (リャンメン待ち)
- [sample2.json](sample2.json) (カンチャン待ち)
- [sample3.json](sample3.json) (ペンチャン待ち)
- [sample4.json](sample4.json) (タンキ待ち)
- [sample5.json](sample5.json) (シャボ待ち)
- [sample6.json](sample6.json) (3面待ち)
- [sample7.json](sample7.json) (1向聴形)

## 何切る問題
和了確率, 聴牌確率, 良形聴牌確率の具体的な値を計算することで何切る問題を解くことができます。

例えば788m23466p113567sという手牌を考えます。東場・子・1巡目の条件で, 打牌候補7m, 8m, 1s, 3sに対してそれぞれ打牌したときの和了確率, 聴牌確率, 良形聴牌確率を計算します。以下のJSONファイルを作成します。

- [sample8.json](sample8.json) (打7m)
- [sample9.json](sample9.json) (打8m)
- [sample10.json](sample10.json) (打1s)
- [sample11.json](sample11.json) (打3s)

和了確率, 聴牌確率, 良形聴牌確率, 得点期待値のすべてで打8mが優れているのでこれが正解となります。

```
$ python3 calc.py sample/sample9.json
Enter the remaining turns.
17

Hai: 788m23466p113567s
Probability:
Turn    Agari   Gukei   Ryoukei Tempai
1       0       0.0656  0.0656  0.131
2       0.0065  0.123   0.123   0.246
3       0.0184  0.173   0.173   0.347
4       0.0349  0.217   0.217   0.434
5       0.055   0.256   0.256   0.511
6       0.0781  0.289   0.289   0.578
7       0.104   0.318   0.318   0.636
8       0.131   0.343   0.343   0.687
9       0.159   0.365   0.365   0.731
10      0.189   0.384   0.384   0.769
11      0.219   0.401   0.401   0.802
12      0.249   0.415   0.415   0.83
13      0.28    0.428   0.428   0.855
14      0.31    0.438   0.438   0.876
15      0.34    0.447   0.447   0.895
16      0.369   0.455   0.455   0.91
17      0.398   0.462   0.462   0.924
Score:
Turn    Agari
1       0
2       8.02
3       22.7
4       43
5       67.8
6       96.2
7       127
8       161
9       196
10      232
11      269
12      306
13      343
14      380
15      417
16      453
17      488
```

## TODO
- [ ] 再帰計算による打筋自動生成機能
- [ ] Webアプリ化(GUI化)
